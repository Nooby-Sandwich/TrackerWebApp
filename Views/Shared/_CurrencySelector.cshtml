@using TrackerWebApp.Services
@inject ICurrencyService CurrencyService

@{
    var currencies = await CurrencyService.GetAllCurrenciesAsync();
    var current = Context.Request.Cookies["SelectedCurrency"] ?? "USD";
    var returnUrl = Context.Request.Path + Context.Request.QueryString;
}

<form asp-controller="Home"
      asp-action="SetCurrency"
      method="post"
      class="d-flex align-items-center">
    @Html.AntiForgeryToken()
    <input type="hidden" name="returnUrl" value="@returnUrl" />

    <select name="currency"
            class="form-select form-select-sm me-2"
            onchange="this.form.submit()">
        <option disabled selected hidden>Select currency</option>
        @foreach (var c in currencies)
        {
            <option value="@c.Code" selected="@(c.Code == current ? "selected" : null)">
                @c.Code – @c.Name
            </option>
        }
    </select>

    <noscript>
        <button type="submit" class="btn btn-sm btn-primary">Set</button>
    </noscript>
</form>